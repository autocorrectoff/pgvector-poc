package main

import (
	"fmt"
	"log"

	"github.com/jmoiron/sqlx"
)

func main() {
	db, err := sqlx.Open("pgx", "postgres://postgres:password@localhost:5432/vectordb?sslmode=disable")
	if err != nil {
		log.Fatalf("Failed to connect to database: %v", err)
	}
	defer db.Close()

	// err = InsertEmbeddingsFromJSONL("embeddings.jsonl", db, 8)
	// if err != nil {
	// 	log.Fatalf("Failed to insert embeddings: %v", err)
	// }

	// log.Println("Finished inserting embeddings.")

	embedding := []float32{1.2386387586593628,0.25294652581214905,-4.085752010345459,-0.08102458715438843,0.655651867389679,0.44984281063079834,-0.8945004343986511,-0.11271502077579498,0.2931841015815735,-0.32436686754226685,0.5606380701065063,-0.1830906867980957,1.7549662590026855,0.2194494605064392,0.588660717010498,-0.5534022450447083,-0.35176315903663635,-0.7426316738128662,0.7920176386833191,1.0460867881774902,0.12301972508430481,-0.6409726142883301,-0.4318380355834961,0.07135950773954391,2.0569353103637695,-0.22551625967025757,0.8939276933670044,-0.27037397027015686,0.3479868173599243,-0.08416461944580078,-0.8912355303764343,-0.5940558910369873,-1.4426217079162598,-0.42025643587112427,-1.0702626705169678,-0.5030074715614319,0.6624595522880554,0.0908331647515297,0.7054232358932495,-0.42148280143737793,-0.6545726656913757,-0.5934571027755737,-0.9561924934387207,0.6143701076507568,2.0431766510009766,1.3865236043930054,0.09147193282842636,-0.2698558270931244,0.06165929138660431,-1.1403878927230835,0.20063945651054382,-1.3460325002670288,1.2456438541412354,0.49336937069892883,1.0041168928146362,0.8665726780891418,2.0559990406036377,-0.21196629106998444,0.38318178057670593,0.5634220242500305,0.632296621799469,1.2683913707733154,-0.7366112470626831,1.680767297744751,0.11167396605014801,-0.8045325875282288,-0.22695407271385193,-0.09335293620824814,-0.2023463100194931,-1.6371235847473145,1.5157667398452759,-1.3082422018051147,0.6342694759368896,-0.12249165773391724,0.28925004601478577,0.345210462808609,-0.6353830099105835,-0.4215598702430725,0.49105730652809143,-0.7662516832351685,-0.047980617731809616,0.6396860480308533,0.06364700198173523,0.6609926819801331,1.9182144403457642,1.3509207963943481,-0.4956684410572052,-0.29374995827674866,-0.6872400641441345,0.6090284585952759,-0.3120773136615753,-0.42901650071144104,0.28042474389076233,0.026881009340286255,-0.6465960741043091,0.20074591040611267,-0.6132090091705322,1.4050650596618652,-0.14016218483448029,0.5655262470245361,-0.4970589578151703,-0.2253788262605667,-0.2930132746696472,-0.924525797367096,2.170409679412842,2.0262677669525146,0.0052731879986822605,-0.6367229223251343,0.3190571069717407,0.07562658935785294,-0.27107664942741394,0.3266275227069855,0.727493166923523,0.05981713533401489,-0.8431475758552551,-1.223419189453125,2.8106706142425537,-0.8143075704574585,1.7062311172485352,0.2587646245956421,0.31376224756240845,-0.14871574938297272,-1.540596604347229,2.7384703159332275,0.00468271691352129,-0.2837028503417969,-0.3642108142375946,-0.5694081783294678,-0.18976280093193054,-0.15857775509357452,0.5862881541252136,-1.2782961130142212,-0.017587367445230484,0.08909166604280472,1.720497965812683,1.3988608121871948,-0.22811219096183777,-0.8412814140319824,0.3225647807121277,1.7238608598709106,1.150391936302185,-1.8373315334320068,1.1910769939422607,-0.6875349879264832,-0.7322705984115601,-0.022674573585391045,0.11907503008842468,-1.0797064304351807,-0.789103090763092,-1.127347469329834,-0.028760625049471855,1.0580310821533203,-0.44332900643348694,-1.3926050662994385,1.2077440023422241,-0.8139340877532959,-1.2897669076919556,0.4765457808971405,0.9492877125740051,0.9264794588088989,1.0468730926513672,0.5559116005897522,0.10589737445116043,1.2954832315444946,-1.4048203229904175,-1.5990089178085327,0.1817886084318161,1.229325532913208,-0.05636555328965187,0.4421325922012329,-1.4666681289672852,-1.1248902082443237,-0.09789080917835236,-0.6852590441703796,0.01944124326109886,-0.0213350560516119,0.4012603461742401,0.07475122064352036,-0.6591848134994507,-0.2551231384277344,-0.09157148003578186,-0.11081542819738388,0.8809006810188293,0.8631013631820679,-1.0620536804199219,0.13169974088668823,1.048953652381897,0.12223099917173386,-1.062458872795105,-1.3459950685501099,0.47143104672431946,0.9990464448928833,-1.4386208057403564,-0.1656886637210846,-0.8361404538154602,0.12376357614994049,-0.21416474878787994,-0.15609072148799896,-0.033041540533304214,-0.7563261985778809,0.36506056785583496,-0.7117577195167542,-0.27347663044929504,-0.030033662915229797,-1.8488187789916992,0.7047585844993591,-0.5139298439025879,1.8665549755096436,0.5380246639251709,0.3952764570713043,0.9889207482337952,-1.2169599533081055,-0.41761183738708496,1.0800960063934326,0.22327864170074463,-1.0512521266937256,-0.17378713190555573,-0.5648012757301331,0.12798088788986206,0.14457809925079346,-0.5842336416244507,-0.933118999004364,-0.23138080537319183,-0.2682191729545593,0.6591692566871643,-0.7895262837409973,-0.35462918877601624,0.15978267788887024,-0.8690334558486938,-0.07807537168264389,0.36626365780830383,-0.879231333732605,0.6772114634513855,1.1335811614990234,0.8561075925827026,-0.20303377509117126,1.0764256715774536,1.0873321294784546,0.8861680030822754,-0.34939348697662354,-0.6325964331626892,-0.274186372756958,0.09920097887516022,-0.8868840336799622,-0.45006224513053894,1.5532453060150146,1.535925269126892,-1.0496370792388916,-0.27063947916030884,0.5876532793045044,0.4202985167503357,-1.4064112901687622,0.2718513011932373,0.8368618488311768,0.17542536556720734,0.036138031631708145,-1.4420406818389893,-0.8715908527374268,-1.2318781614303589,0.6799756288528442,1.9270752668380737,-0.7770803570747375,-0.15248487889766693,-0.31502509117126465,1.3034898042678833,-0.32080838084220886,-0.17716005444526672,1.1654555797576904,1.1308866739273071,-0.1793908029794693,0.1933971494436264,1.3418467044830322,0.7522200345993042,0.09693086892366409,-0.6493414044380188,-2.15274715423584,0.8847808837890625,-0.35967379808425903,0.6596738696098328,-0.14454860985279083,-1.0694482326507568,-0.5839361548423767,-1.4105541706085205,0.7050389051437378,-0.669205904006958,-0.3815719485282898,-0.26505646109580994,-0.305024653673172,-0.4847875237464905,-0.28114083409309387,-0.09970609843730927,-0.11296042054891586,0.33896660804748535,0.2606031596660614,-0.17628410458564758,0.4951375126838684,0.10413426905870438,0.055982474237680435,-0.2291305959224701,-0.4384482800960541,0.2084358036518097,0.1768312156200409,-0.2517451345920563,-0.3775579631328583,-0.5891373753547668,0.6857439279556274,0.8380642533302307,-1.0984054803848267,0.9462274312973022,-1.5422004461288452,-0.43860557675361633,0.727124810218811,-0.36106419563293457,0.20527254045009613,-2.116504192352295,1.7350108623504639,-0.568640947341919,0.18644466996192932,0.2734390199184418,-0.5171082019805908,-0.27377668023109436,-0.642789900302887,0.6192831993103027,-1.4227628707885742,-0.8430468440055847,0.8025188446044922,-0.21793889999389648,0.859838604927063,-0.13309574127197266,-0.5132758021354675,-1.2846871614456177,-0.7151432037353516,0.14155569672584534,0.12367720156908035,-0.9226600527763367,0.9004873633384705,-0.6951603293418884,-0.47080928087234497,0.14798595011234283,1.3858134746551514,2.08695912361145,-0.45035141706466675,-0.02674431912600994,-0.6215345859527588,-0.3417719006538391,0.5980435609817505,-0.7465980648994446,-1.0018254518508911,0.5688385367393494,0.41329824924468994,0.12250503152608871,-0.33239156007766724,-0.2976991832256317,0.04297610744833946,0.4859063923358917,-0.7636723518371582,0.6268600821495056,-0.6899869441986084,-0.3216640055179596,0.034896425902843475,0.6991090774536133,-0.43378496170043945,0.3093637228012085,-1.5382415056228638,0.24739418923854828,0.8387615084648132,0.19611045718193054,-0.4861694574356079,-0.14243637025356293,-0.0016837710281834006,-1.347274661064148,-0.42228490114212036,-1.180577278137207,1.3632547855377197,0.07743825763463974,-0.10911127179861069,-0.6954833269119263,-0.4574914872646332,-0.3439290523529053,1.2386375665664673,-0.3481055498123169,-0.11092371493577957,0.40306469798088074,0.6792454719543457,-0.09975390136241913,-0.25606873631477356,0.33933931589126587,-0.3444938659667969,1.1748061180114746,-0.1730494648218155,0.2483396828174591,-0.6296940445899963,-0.9150344729423523,-0.00808938592672348,0.605385422706604,0.07491013407707214,0.7764421701431274,0.4351491928100586,0.0902944952249527,0.2313546985387802,0.3088400661945343,0.030477222055196762,0.22651219367980957,0.04176820069551468,1.3487777709960938,-0.20073449611663818,0.3922879695892334,-0.6468999981880188,2.0155413150787354,0.5816674828529358,1.0085711479187012,0.9013242125511169,1.0020698308944702,-2.052912950515747,0.7457976937294006,0.43660226464271545,0.6236051917076111,-0.9724893569946289,-0.8957090973854065,1.3961400985717773,-0.3706323206424713,1.4780572652816772,-0.17142106592655182,-0.46272894740104675,-0.30208030343055725,0.5933135151863098,-0.20851550996303558,0.3457333743572235,-1.3821234703063965,-1.860168695449829,0.44159063696861267,1.3653056621551514,0.18989300727844238,-0.6546772718429565,0.617483913898468,0.505484402179718,-0.1766677051782608,0.5611844062805176,0.5594640970230103,1.817853331565857,1.3090673685073853,-1.5396431684494019,-0.8975854516029358,-0.23433390259742737,-0.5232102870941162,0.6857708096504211,2.034834384918213,-0.680176317691803,-0.45076802372932434,0.5805574059486389,-0.9191997647285461,0.2886753976345062,-0.6816805601119995,-0.623206377029419,1.3158893585205078,0.20930610597133636,-0.46040886640548706,0.10252109169960022,1.4390918016433716,-0.8811741471290588,-0.12087695300579071,-0.18661412596702576,-0.7955330610275269,0.37605735659599304,1.0531718730926514,0.3825358748435974,-0.0357523038983345,-0.4474875032901764,-0.7699468731880188,0.33729344606399536,-0.4732695519924164,0.6403408646583557,-0.7317713499069214,0.1104036420583725,-0.6055641174316406,0.5281221270561218,-1.2446707487106323,-1.0148075819015503,0.8482441306114197,0.5990655422210693,0.587486207485199,-0.4198592007160187,-0.22203919291496277,-1.390967845916748,0.0869365707039833,0.8168482184410095,0.020657062530517578,-0.44597530364990234,0.8060482740402222,-1.3078781366348267,0.3840683102607727,-0.13378044962882996,0.08501008152961731,-1.165522575378418,-0.0965186208486557,-0.2108185589313507,-0.7725241184234619,-1.2958754301071167,0.930537760257721,-0.2759248614311218,0.4962482452392578,2.1575067043304443,-0.25769394636154175,1.218049168586731,0.8020629286766052,-0.512032151222229,0.17216309905052185,-0.2675309479236603,-0.14100675284862518,0.9194251894950867,-0.6854050755500793,-0.37155985832214355,-0.659079909324646,0.6130039095878601,1.6672643423080444,0.0301495548337698,1.3020541667938232,0.13383077085018158,-0.4853334426879883,0.5496727228164673,0.44620227813720703,-0.8413493037223816,-0.4602556824684143,-1.5203436613082886,-1.529800295829773,0.0005368799902498722,-0.022398939356207848,-0.16988350450992584,-0.26060283184051514,1.0908632278442383,0.18321648240089417,0.46673017740249634,0.4685726463794708,0.4877748191356659,0.8003671765327454,0.4275934398174286,0.23485592007637024,-0.13242743909358978,0.9189081192016602,0.36882519721984863,0.4026055932044983,0.9577031135559082,0.3734467029571533,0.15397082269191742,0.06204824149608612,0.9194990396499634,0.15199634432792664,0.7690255045890808,-0.04866420105099678,-0.8477639555931091,0.7921462655067444,-1.6255810260772705,0.5121092200279236,-1.0098429918289185,-1.2647541761398315,-0.6273527145385742,-0.6663026213645935,-1.2043699026107788,-2.0396173000335693,-0.9226219058036804,0.49025899171829224,0.745253324508667,1.3929282426834106,0.4821953773498535,0.2899318337440491,-0.26532959938049316,0.41404014825820923,-1.2083812952041626,0.1752016842365265,-0.04487726092338562,0.4901929795742035,0.1996302455663681,-0.0007268284098245203,0.8095499873161316,-0.5073685050010681,-0.4171838164329529,-0.04914779216051102,1.0326370000839233,-1.533440113067627,-0.16186220943927765,-0.3072325587272644,-0.8145559430122375,0.8705477714538574,0.14618588984012604,0.03525656461715698,-0.44403284788131714,-0.7431981563568115,0.34185442328453064,0.4994186460971832,1.1723227500915527,0.22136226296424866,0.0434873104095459,-0.22416289150714874,-0.1368991583585739,-0.1674438714981079,0.7477883696556091,-1.4792588949203491,-0.7346461415290833,0.0012824697187170386,-1.500879168510437,0.6180710196495056,-0.3291192948818207,0.9473392963409424,0.43991589546203613,0.4280158579349518,1.8739643096923828,-0.05335743725299835,-0.8302987813949585,-0.6221771240234375,-0.1911783516407013,1.7835291624069214,0.08288127928972244,1.0239403247833252,-0.7024118900299072,0.16547906398773193,0.5474793314933777,-0.19242322444915771,0.12360553443431854,-0.7708832621574402,-0.8301332592964172,0.24077531695365906,-1.0559570789337158,0.19858059287071228,-1.1281251907348633,1.208614706993103,-0.10141872614622116,-0.7119329571723938,-0.45933395624160767,0.7694567441940308,0.8377245664596558,-0.8102954030036926,0.5654433369636536,-2.4330215454101562,-1.086759090423584,-0.6625981330871582,0.3572453260421753,-0.20560216903686523,0.5365588068962097,1.6093322038650513,0.5015310049057007,0.20302799344062805,0.33360978960990906,-0.6324215531349182,-0.49810102581977844,0.9738645553588867,-1.6075884103775024,-0.5469575524330139,0.46560537815093994,0.7782047390937805,-0.056142229586839676,-0.5943019986152649,0.7941112518310547,0.9144609570503235,0.6197689771652222,0.4102766513824463,0.9042972922325134,0.4929965138435364,-0.5662674307823181,-1.4588817358016968,-1.0987831354141235,-0.26873427629470825,-0.11744076013565063,-0.5545133352279663,0.7499405741691589,-0.534771740436554,-0.06471211463212967,0.5249872207641602,0.15619130432605743,-0.8764696717262268,-1.008279800415039,0.17557445168495178,-0.6013118624687195,-0.9073525667190552,0.0965050756931305,0.133291095495224,-0.060550808906555176,-0.04687998816370964,0.08902677893638611,-1.104751706123352,-1.3950016498565674,0.04170946031808853,-1.1091976165771484,1.1760576963424683,0.4114196300506592,-0.1311722695827484,0.29191839694976807,-0.1441856175661087,0.45296260714530945,0.15013477206230164,-1.6575462818145752,-0.30733218789100647,-0.17000314593315125,1.4537544250488281,-0.3208034336566925,-0.29255858063697815,-0.8620016574859619,0.7847356200218201,0.15745809674263,-1.521409511566162,1.0280367136001587,-0.09809073805809021,1.2175507545471191,-0.3505874574184418,1.933288335800171,-0.8640390634536743,1.2163307666778564,0.5358920097351074,0.4310154318809509,-0.41351544857025146,0.7544982433319092,-1.2284736633300781,-0.8769538402557373,-0.5714513063430786,1.0646381378173828,-0.6263418793678284,0.3026033639907837,1.1897153854370117,-1.795889139175415,-1.4395147562026978,1.031900405883789,0.7557363510131836,1.2187862396240234,-1.4254155158996582,-1.6053541898727417,-0.6420880556106567,-0.46353086829185486,0.5285905003547668,-0.8118728399276733,0.8901799321174622,-0.714806854724884,-0.10724977403879166,0.25249993801116943,-0.4046839773654938,0.850263774394989,-1.0642130374908447,0.3658238351345062,-0.3207729756832123,-0.2382851392030716,-0.266800194978714,0.0007984859403222799,-0.9132365584373474,-0.4832272529602051,0.7326065897941589,0.5061839818954468,-0.09875677525997162,-0.14409179985523224,-0.06594345718622208,0.15506699681282043,-0.13139395415782928,0.13302598893642426,0.5414913892745972,0.616340160369873,-0.34357377886772156,0.9264156818389893,0.11102303862571716,0.08734096586704254,0.7467299103736877,1.3972868919372559,1.2869644165039062,0.3032586872577667,0.3791349232196808,-1.0613865852355957,1.2994976043701172,-0.4666300117969513,-0.6592503786087036,-0.9350515007972717,-1.380292534828186,-1.0639022588729858} // Example embedding

	results, err := QuerySimilarWords(db, embedding, 5)
	if err != nil {
		log.Fatal(err)
	}
	for _, r := range results {
		fmt.Printf("%d: %s â†’ distance: %.4f\n", r.ID, r.Word, r.Distance)
	}
}
